{"version":3,"file":"menu-button.cjs.development.js","sources":["../src/index.tsx"],"sourcesContent":["/**\n * Welcome to @reach/menu-button!\n *\n * An accessible dropdown menu for the common dropdown menu button design\n * pattern.\n *\n * @see Docs     https://reach.tech/menu-button\n * @see Source   https://github.com/reach/reach-ui/tree/main/packages/menu-button\n * @see WAI-ARIA https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\n *\n * TODO: Fix flash when opening a menu button on a screen with another open menu\n */\n\nimport * as React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { useId } from \"@reach/auto-id\";\nimport { Popover, Position } from \"@reach/popover\";\nimport {\n  createDescendantContext,\n  DescendantProvider,\n  useDescendant,\n  useDescendants,\n  useDescendantsInit,\n  useDescendantKeyDown,\n} from \"@reach/descendants\";\nimport {\n  createNamedContext,\n  forwardRefWithAs,\n  getOwnerDocument,\n  isFunction,\n  isString,\n  makeId,\n  noop,\n  useCheckStyles,\n  useForkedRef,\n  usePrevious,\n  wrapEvent,\n} from \"@reach/utils\";\n\nimport type { Descendant } from \"@reach/descendants\";\n\n////////////////////////////////////////////////////////////////////////////////\n// Actions\n\nconst CLEAR_SELECTION_INDEX = \"CLEAR_SELECTION_INDEX\";\nconst CLICK_MENU_ITEM = \"CLICK_MENU_ITEM\";\nconst CLOSE_MENU = \"CLOSE_MENU\";\nconst OPEN_MENU_AT_FIRST_ITEM = \"OPEN_MENU_AT_FIRST_ITEM\";\nconst OPEN_MENU_AT_INDEX = \"OPEN_MENU_AT_INDEX\";\nconst OPEN_MENU_CLEARED = \"OPEN_MENU_CLEARED\";\nconst SEARCH_FOR_ITEM = \"SEARCH_FOR_ITEM\";\nconst SELECT_ITEM_AT_INDEX = \"SELECT_ITEM_AT_INDEX\";\nconst SET_BUTTON_ID = \"SET_BUTTON_ID\";\n\nconst MenuDescendantContext = createDescendantContext<MenuButtonDescendant>(\n  \"MenuDescendantContext\"\n);\nconst MenuContext = createNamedContext<InternalMenuContextValue>(\n  \"MenuContext\",\n  {} as InternalMenuContextValue\n);\n\nconst initialState: MenuButtonState = {\n  // The button ID is needed for aria controls and can be set directly and\n  // updated for top-level use via context. Otherwise a default is set by useId.\n  // TODO: Consider deprecating direct ID in 1.0 in favor of id at the top level\n  //       for passing deterministic IDs to descendent components.\n  buttonId: null,\n\n  // Whether or not the menu is expanded\n  isExpanded: false,\n\n  // When a user begins typing a character string, the selection will change if\n  // a matching item is found\n  typeaheadQuery: \"\",\n\n  // The index of the current selected item. When the selection is cleared a\n  // value of -1 is used.\n  selectionIndex: -1,\n};\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Menu\n *\n * The wrapper component for the other components. No DOM element is rendered.\n *\n * @see Docs https://reach.tech/menu-button#menu\n */\nconst Menu: React.FC<MenuProps> = ({ id, children }) => {\n  let buttonRef = React.useRef(null);\n  let menuRef = React.useRef(null);\n  let popoverRef = React.useRef(null);\n  let [descendants, setDescendants] = useDescendantsInit<\n    MenuButtonDescendant\n  >();\n  let [state, dispatch] = React.useReducer(reducer, initialState);\n  let _id = useId(id);\n  let menuId = id || makeId(\"menu\", _id);\n\n  // We use an event listener attached to the window to capture outside clicks\n  // that close the menu. We don't want the initial button click to trigger this\n  // when a menu is closed, so we can track this behavior in a ref for now.\n  // We shouldn't need this when we rewrite with state machine logic.\n  let buttonClickedRef = React.useRef(false);\n\n  // We will put children callbacks in a ref to avoid triggering endless render\n  // loops when using render props if the app code doesn't useCallback\n  // https://github.com/reach/reach-ui/issues/523\n  let selectCallbacks = React.useRef([]);\n\n  // If the popover's position overlaps with an option when the popover\n  // initially opens, the mouseup event will trigger a select. To prevent that,\n  // we decide the menu button is only ready to make a selection if the pointer\n  // moves first, otherwise the user is just registering the initial button\n  // click rather than selecting an item. This is similar to a native select\n  // on most platforms, and our menu button popover works similarly.\n  let readyToSelect = React.useRef(false);\n\n  let context: InternalMenuContextValue = {\n    buttonRef,\n    dispatch,\n    menuId,\n    menuRef,\n    popoverRef,\n    buttonClickedRef,\n    readyToSelect,\n    selectCallbacks,\n    state,\n  };\n\n  // When the menu is open, focus is placed on the menu itself so that\n  // keyboard navigation is still possible.\n  React.useEffect(() => {\n    if (state.isExpanded) {\n      // @ts-ignore\n      window.__REACH_DISABLE_TOOLTIPS = true;\n      window.requestAnimationFrame(() => {\n        focus(menuRef.current);\n      });\n    } else {\n      // We want to ignore the immediate focus of a tooltip so it doesn't pop\n      // up again when the menu closes, only pops up when focus returns again\n      // to the tooltip (like native OS tooltips).\n      // @ts-ignore\n      window.__REACH_DISABLE_TOOLTIPS = false;\n    }\n  }, [state.isExpanded]);\n\n  useCheckStyles(\"menu-button\");\n\n  return (\n    <DescendantProvider\n      context={MenuDescendantContext}\n      items={descendants}\n      set={setDescendants}\n    >\n      <MenuContext.Provider value={context}>\n        {isFunction(children)\n          ? children({\n              isExpanded: state.isExpanded,\n              // TODO: Remove in 1.0\n              isOpen: state.isExpanded,\n            })\n          : children}\n      </MenuContext.Provider>\n    </DescendantProvider>\n  );\n};\n\n/**\n * @see Docs https://reach.tech/menu-button#menu-props\n */\ninterface MenuProps {\n  /**\n   * Requires two children: a `<MenuButton>` and a `<MenuList>`.\n   *\n   * @see Docs https://reach.tech/menu-button#menu-children\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: MenuContextValue & {\n          // TODO: Remove in 1.0\n          isOpen: boolean;\n        }\n      ) => React.ReactNode);\n  id?: string;\n}\n\nif (__DEV__) {\n  Menu.displayName = \"Menu\";\n  Menu.propTypes = {\n    children: PropTypes.oneOfType([PropTypes.func, PropTypes.node]),\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * MenuButton\n *\n * Wraps a DOM `button` that toggles the opening and closing of the dropdown\n * menu. Must be rendered inside of a `<Menu>`.\n *\n * @see Docs https://reach.tech/menu-button#menubutton\n */\nconst MenuButton = forwardRefWithAs<MenuButtonProps, \"button\">(\n  function MenuButton(\n    { as: Comp = \"button\", onKeyDown, onMouseDown, id, ...props },\n    forwardedRef\n  ) {\n    let {\n      buttonRef,\n      buttonClickedRef,\n      menuId,\n      state: { buttonId, isExpanded },\n      dispatch,\n    } = React.useContext(MenuContext);\n    let ref = useForkedRef(buttonRef, forwardedRef);\n    let items = useDescendants(MenuDescendantContext);\n    let firstNonDisabledIndex = React.useMemo(\n      () => items.findIndex((item) => !item.disabled),\n      [items]\n    );\n    React.useEffect(() => {\n      let newButtonId =\n        id != null\n          ? id\n          : menuId\n          ? makeId(\"menu-button\", menuId)\n          : \"menu-button\";\n      if (buttonId !== newButtonId) {\n        dispatch({\n          type: SET_BUTTON_ID,\n          payload: newButtonId,\n        });\n      }\n    }, [buttonId, dispatch, id, menuId]);\n\n    function handleKeyDown(event: React.KeyboardEvent) {\n      switch (event.key) {\n        case \"ArrowDown\":\n        case \"ArrowUp\":\n          event.preventDefault(); // prevent scroll\n          dispatch({\n            type: OPEN_MENU_AT_INDEX,\n            payload: { index: firstNonDisabledIndex },\n          });\n          break;\n        case \"Enter\":\n        case \" \":\n          dispatch({\n            type: OPEN_MENU_AT_INDEX,\n            payload: { index: firstNonDisabledIndex },\n          });\n          break;\n        default:\n          break;\n      }\n    }\n\n    function handleMouseDown(event: React.MouseEvent) {\n      if (!isExpanded) {\n        buttonClickedRef.current = true;\n      }\n      if (isRightClick(event.nativeEvent)) {\n        return;\n      } else if (isExpanded) {\n        dispatch({ type: CLOSE_MENU, payload: { buttonRef } });\n      } else {\n        dispatch({ type: OPEN_MENU_CLEARED });\n      }\n    }\n\n    return (\n      <Comp\n        // When the menu is displayed, the element with role `button` has\n        // `aria-expanded` set to `true`. When the menu is hidden, it is\n        // recommended that `aria-expanded` is not present.\n        // https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\n        aria-expanded={isExpanded ? true : undefined}\n        // The element with role `button` has `aria-haspopup` set to either\n        // `\"menu\"` or `true`.\n        // https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\n        aria-haspopup\n        // Optionally, the element with role `button` has a value specified for\n        // `aria-controls` that refers to the element with role `menu`.\n        // https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\n        aria-controls={menuId}\n        {...props}\n        ref={ref}\n        data-reach-menu-button=\"\"\n        id={buttonId || undefined}\n        onKeyDown={wrapEvent(onKeyDown, handleKeyDown)}\n        onMouseDown={wrapEvent(onMouseDown, handleMouseDown)}\n        type=\"button\"\n      />\n    );\n  }\n);\n\n/**\n * @see Docs https://reach.tech/menu-button#menubutton-props\n */\ntype MenuButtonProps = {\n  /**\n   * Accepts any renderable content.\n   *\n   * @see Docs https://reach.tech/menu-button#menubutton-children\n   */\n  children: React.ReactNode;\n};\n\nif (__DEV__) {\n  MenuButton.displayName = \"MenuButton\";\n  MenuButton.propTypes = {\n    children: PropTypes.node,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * MenuItemImpl\n *\n * MenuItem and MenuLink share most of the same functionality captured here.\n */\nconst MenuItemImpl = forwardRefWithAs<MenuItemImplProps, \"div\">(\n  function MenuItemImpl(\n    {\n      as: Comp,\n      index: indexProp,\n      isLink = false,\n      onClick,\n      onDragStart,\n      onMouseDown,\n      onMouseEnter,\n      onMouseLeave,\n      onMouseMove,\n      onMouseUp,\n      onSelect,\n      disabled,\n      valueText: valueTextProp,\n      ...props\n    },\n    forwardedRef\n  ) {\n    let {\n      buttonRef,\n      dispatch,\n      readyToSelect,\n      selectCallbacks,\n      state: { selectionIndex, isExpanded },\n    } = React.useContext(MenuContext);\n    let ownRef = React.useRef<HTMLElement | null>(null);\n    // After the ref is mounted to the DOM node, we check to see if we have an\n    // explicit valueText prop before looking for the node's textContent for\n    // typeahead functionality.\n    let [valueText, setValueText] = React.useState(valueTextProp || \"\");\n    let setValueTextFromDom = React.useCallback(\n      (node) => {\n        if (node) {\n          ownRef.current = node;\n          if (\n            !valueTextProp ||\n            (node.textContent && valueText !== node.textContent)\n          ) {\n            setValueText(node.textContent);\n          }\n        }\n      },\n      [valueText, valueTextProp]\n    );\n\n    let ref = useForkedRef(forwardedRef, setValueTextFromDom);\n\n    let mouseEventStarted = React.useRef(false);\n\n    let index = useDescendant(\n      {\n        element: ownRef.current!,\n        key: valueText,\n        disabled,\n        isLink,\n      },\n      MenuDescendantContext,\n      indexProp\n    );\n    let isSelected = index === selectionIndex && !disabled;\n\n    // Update the callback ref array on every render\n    selectCallbacks.current[index] = onSelect;\n\n    function select() {\n      focus(buttonRef.current);\n      onSelect && onSelect();\n      dispatch({ type: CLICK_MENU_ITEM });\n    }\n\n    function handleClick(event: React.MouseEvent) {\n      if (isLink && !isRightClick(event.nativeEvent)) {\n        if (disabled) {\n          event.preventDefault();\n        } else {\n          select();\n        }\n      }\n    }\n\n    function handleDragStart(event: React.MouseEvent) {\n      // Because we don't preventDefault on mousedown for links (we need the\n      // native click event), clicking and holding on a link triggers a\n      // dragstart which we don't want.\n      if (isLink) {\n        event.preventDefault();\n      }\n    }\n\n    function handleMouseDown(event: React.MouseEvent) {\n      if (isRightClick(event.nativeEvent)) return;\n\n      if (isLink) {\n        // Signal that the mouse is down so we can react call the right function\n        // if the user is clicking on a link.\n        mouseEventStarted.current = true;\n      } else {\n        event.preventDefault();\n      }\n    }\n\n    function handleMouseEnter(event: React.MouseEvent) {\n      if (!isSelected && index != null && !disabled) {\n        dispatch({ type: SELECT_ITEM_AT_INDEX, payload: { index } });\n      }\n    }\n\n    function handleMouseLeave(event: React.MouseEvent) {\n      // Clear out selection when mouse over a non-menu item child.\n      dispatch({ type: CLEAR_SELECTION_INDEX });\n    }\n\n    function handleMouseMove() {\n      readyToSelect.current = true;\n      if (!isSelected && index != null && !disabled) {\n        dispatch({ type: SELECT_ITEM_AT_INDEX, payload: { index } });\n      }\n    }\n\n    function handleMouseUp(event: React.MouseEvent) {\n      if (!readyToSelect.current) {\n        readyToSelect.current = true;\n        return;\n      }\n      if (isRightClick(event.nativeEvent)) return;\n\n      if (isLink) {\n        // If a mousedown event was initiated on a menu link followed by a\n        // mouseup event on the same link, we do nothing; a click event will\n        // come next and handle selection. Otherwise, we trigger a click event.\n        if (mouseEventStarted.current) {\n          mouseEventStarted.current = false;\n        } else if (ownRef.current) {\n          ownRef.current.click();\n        }\n      } else {\n        if (!disabled) {\n          select();\n        }\n      }\n    }\n\n    // When the menu closes, reset readyToSelect for the next interaction.\n    React.useEffect(() => {\n      if (!isExpanded) {\n        readyToSelect.current = false;\n      }\n    }, [isExpanded, readyToSelect]);\n\n    // Any time a mouseup event occurs anywhere in the document, we reset the\n    // mouseEventStarted ref so we can check it again when needed.\n    React.useEffect(() => {\n      let ownerDocument = getOwnerDocument(ownRef.current)!;\n      let listener = () => (mouseEventStarted.current = false);\n      ownerDocument.addEventListener(\"mouseup\", listener);\n      return () => ownerDocument.removeEventListener(\"mouseup\", listener);\n    }, []);\n\n    return (\n      <Comp\n        role=\"menuitem\"\n        id={useMenuItemId(index)}\n        tabIndex={-1}\n        {...props}\n        ref={ref}\n        aria-disabled={disabled || undefined}\n        data-reach-menu-item=\"\"\n        data-selected={isSelected ? \"\" : undefined}\n        data-valuetext={valueText}\n        onClick={wrapEvent(onClick, handleClick)}\n        onDragStart={wrapEvent(onDragStart, handleDragStart)}\n        onMouseDown={wrapEvent(onMouseDown, handleMouseDown)}\n        onMouseEnter={wrapEvent(onMouseEnter, handleMouseEnter)}\n        onMouseLeave={wrapEvent(onMouseLeave, handleMouseLeave)}\n        onMouseMove={wrapEvent(onMouseMove, handleMouseMove)}\n        onMouseUp={wrapEvent(onMouseUp, handleMouseUp)}\n      />\n    );\n  }\n);\n\ntype MenuItemImplProps = {\n  /**\n   * You can put any type of content inside of a `<MenuItem>`.\n   *\n   * @see Docs https://reach.tech/menu-button#menuitem-children\n   */\n  children: React.ReactNode;\n  /**\n   * Callback that fires when a `MenuItem` is selected.\n   *\n   * @see Docs https://reach.tech/menu-button#menuitem-onselect\n   */\n  onSelect(): void;\n  index?: number;\n  isLink?: boolean;\n  valueText?: string;\n  /**\n   * Whether or not the item is disabled from selection and navigation.\n   *\n   * @see Docs https://reach.tech/menu-button#menuitem-disabled\n   */\n  disabled?: boolean;\n};\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * MenuItem\n *\n * Handles menu selection. Must be a direct child of a `<MenuList>`.\n *\n * @see Docs https://reach.tech/menu-button#menuitem\n */\nconst MenuItem = forwardRefWithAs<MenuItemProps, \"div\">(function MenuItem(\n  { as = \"div\", ...props },\n  forwardedRef\n) {\n  return <MenuItemImpl {...props} ref={forwardedRef} as={as} />;\n});\n\n/**\n * @see Docs https://reach.tech/menu-button#menuitem-props\n */\ntype MenuItemProps = Omit<MenuItemImplProps, \"isLink\">;\n\nif (__DEV__) {\n  MenuItem.displayName = \"MenuItem\";\n  MenuItem.propTypes = {\n    as: PropTypes.any,\n    onSelect: PropTypes.func.isRequired,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * MenuItems\n *\n * A low-level wrapper for menu items. Compose it with `MenuPopover` for more\n * control over the nested components and their rendered DOM nodes, or if you\n * need to nest arbitrary components between the outer wrapper and your list.\n *\n * @see Docs https://reach.tech/menu-button#menuitems\n */\nconst MenuItems = forwardRefWithAs<MenuItemsProps, \"div\">(function MenuItems(\n  { as: Comp = \"div\", children, id, onKeyDown, ...props },\n  forwardedRef\n) {\n  const {\n    menuId,\n    dispatch,\n    buttonRef,\n    menuRef,\n    selectCallbacks,\n    state: { isExpanded, buttonId, selectionIndex, typeaheadQuery },\n  } = React.useContext(MenuContext);\n  const menuItems = useDescendants(MenuDescendantContext);\n  const ref = useForkedRef(menuRef, forwardedRef);\n\n  React.useEffect(() => {\n    // Respond to user char key input with typeahead\n    const match = findItemFromTypeahead(menuItems, typeaheadQuery);\n    if (typeaheadQuery && match != null) {\n      dispatch({\n        type: SELECT_ITEM_AT_INDEX,\n        payload: { index: match },\n      });\n    }\n    let timeout = window.setTimeout(\n      () => typeaheadQuery && dispatch({ type: SEARCH_FOR_ITEM, payload: \"\" }),\n      1000\n    );\n    return () => window.clearTimeout(timeout);\n  }, [dispatch, menuItems, typeaheadQuery]);\n\n  const prevMenuItemsLength = usePrevious(menuItems.length);\n  const prevSelected = usePrevious(menuItems[selectionIndex]);\n  const prevSelectionIndex = usePrevious(selectionIndex);\n\n  React.useEffect(() => {\n    if (selectionIndex > menuItems.length - 1) {\n      // If for some reason our selection index is larger than our possible\n      // index range (let's say the last item is selected and the list\n      // dynamically updates), we need to select the last item in the list.\n      dispatch({\n        type: SELECT_ITEM_AT_INDEX,\n        payload: { index: menuItems.length - 1 },\n      });\n    } else if (\n      // Checks if\n      //  - menu length has changed\n      //  - selection index has not changed BUT selected item has changed\n      //\n      // This prevents any dynamic adding/removing of menu items from actually\n      // changing a user's expected selection.\n      prevMenuItemsLength !== menuItems.length &&\n      selectionIndex > -1 &&\n      prevSelected &&\n      prevSelectionIndex === selectionIndex &&\n      menuItems[selectionIndex] !== prevSelected\n    ) {\n      dispatch({\n        type: SELECT_ITEM_AT_INDEX,\n        payload: {\n          index: menuItems.findIndex((i) => i.key === prevSelected.key),\n        },\n      });\n    }\n  }, [\n    dispatch,\n    menuItems,\n    prevMenuItemsLength,\n    prevSelected,\n    prevSelectionIndex,\n    selectionIndex,\n  ]);\n\n  let handleKeyDown = wrapEvent(\n    function handleKeyDown(event: React.KeyboardEvent) {\n      let { key } = event;\n\n      if (!isExpanded) {\n        return;\n      }\n\n      switch (key) {\n        case \"Enter\":\n        case \" \":\n          let selected = menuItems.find(\n            (item) => item.index === selectionIndex\n          );\n          // For links, the Enter key will trigger a click by default, but for\n          // consistent behavior across menu items we'll trigger a click when\n          // the spacebar is pressed.\n          if (selected) {\n            if (selected.isLink && selected.element) {\n              selected.element.click();\n            } else {\n              event.preventDefault();\n              // Focus the button first by default when an item is selected.\n              // We fire the onSelect callback next so the app can manage\n              // focus if needed.\n              focus(buttonRef.current);\n              selectCallbacks.current[selected.index] &&\n                selectCallbacks.current[selected.index]();\n              dispatch({ type: CLICK_MENU_ITEM });\n            }\n          }\n          break;\n        case \"Escape\":\n          focus(buttonRef.current);\n          dispatch({ type: CLOSE_MENU, payload: { buttonRef } });\n          break;\n        case \"Tab\":\n          // prevent leaving\n          event.preventDefault();\n          break;\n        default:\n          // Check if a user is typing some char keys and respond by setting\n          // the query state.\n          if (isString(key) && key.length === 1) {\n            const query = typeaheadQuery + key.toLowerCase();\n            dispatch({\n              type: SEARCH_FOR_ITEM,\n              payload: query,\n            });\n          }\n          break;\n      }\n    },\n    useDescendantKeyDown(MenuDescendantContext, {\n      currentIndex: selectionIndex,\n      orientation: \"vertical\",\n      rotate: false,\n      filter: (item) => !item.disabled,\n      callback: (index: number) => {\n        dispatch({\n          type: SELECT_ITEM_AT_INDEX,\n          payload: { index },\n        });\n      },\n      key: \"index\",\n    })\n  );\n\n  return (\n    // TODO: Should probably file a but in jsx-a11y, but this is correct\n    // according to https://www.w3.org/TR/wai-aria-practices-1.2/examples/menu-button/menu-button-actions-active-descendant.html\n    // eslint-disable-next-line jsx-a11y/aria-activedescendant-has-tabindex\n    <Comp\n      // Refers to the descendant menuitem element that is visually indicated\n      // as focused.\n      // https://www.w3.org/TR/wai-aria-practices-1.2/examples/menu-button/menu-button-actions-active-descendant.html\n      aria-activedescendant={useMenuItemId(selectionIndex) || undefined}\n      // Refers to the element that contains the accessible name for the\n      // `menu`. The menu is labeled by the menu button.\n      // https://www.w3.org/TR/wai-aria-practices-1.2/examples/menu-button/menu-button-actions-active-descendant.html\n      aria-labelledby={buttonId || undefined}\n      // The element that contains the menu items displayed by activating the\n      // button has role menu.\n      // https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\n      role=\"menu\"\n      tabIndex={-1}\n      {...props}\n      ref={ref}\n      data-reach-menu-items=\"\"\n      id={menuId}\n      onKeyDown={wrapEvent(onKeyDown, handleKeyDown)}\n    >\n      {children}\n    </Comp>\n  );\n});\n\n/**\n * @see Docs https://reach.tech/menu-button#menuitems-props\n */\ntype MenuItemsProps = {\n  /**\n   * Can contain only `MenuItem` or a `MenuLink`.\n   *\n   * @see Docs https://reach.tech/menu-button#menuitems-children\n   */\n  children: React.ReactNode;\n};\n\nif (__DEV__) {\n  MenuItems.displayName = \"MenuItems\";\n  MenuItems.propTypes = {\n    children: PropTypes.node,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * MenuLink\n *\n * Handles linking to a different page in the menu. By default it renders `<a>`,\n * but also accepts any other kind of Link as long as the `Link` uses the\n * `React.forwardRef` API.\n *\n * Must be a direct child of a `<MenuList>`.\n *\n * @see Docs https://reach.tech/menu-button#menulink\n */\nconst MenuLink = forwardRefWithAs<MenuLinkProps & { component?: any }, \"a\">(\n  function MenuLink({ as = \"a\", component, onSelect, ...props }, forwardedRef) {\n    if (component) {\n      console.warn(\n        \"[@reach/menu-button]: Please use the `as` prop instead of `component`.\"\n      );\n    }\n\n    return (\n      <div role=\"none\" tabIndex={-1}>\n        <MenuItemImpl\n          {...props}\n          ref={forwardedRef}\n          data-reach-menu-link=\"\"\n          as={as}\n          isLink={true}\n          onSelect={onSelect || noop}\n        />\n      </div>\n    );\n  }\n);\n\n/**\n * @see Docs https://reach.tech/menu-button#menulink-props\n */\ntype MenuLinkProps = Omit<MenuItemImplProps, \"isLink\" | \"onSelect\"> & {\n  onSelect?(): void;\n};\n\nif (__DEV__) {\n  MenuLink.displayName = \"MenuLink\";\n  MenuLink.propTypes = {\n    as: PropTypes.any,\n    component: PropTypes.any,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * MenuList\n *\n * Wraps a DOM element that renders the menu items. Must be rendered inside of\n * a `<Menu>`.\n *\n * @see Docs https://reach.tech/menu-button#menulist\n */\nconst MenuList = forwardRefWithAs<MenuListProps, \"div\">(function MenuList(\n  { portal = true, ...props },\n  forwardedRef\n) {\n  return (\n    <MenuPopover portal={portal}>\n      <MenuItems {...props} ref={forwardedRef} data-reach-menu-list=\"\" />\n    </MenuPopover>\n  );\n});\n\n/**\n * @see Docs https://reach.tech/menu-button#menulist-props\n */\ntype MenuListProps = {\n  /**\n   * Whether or not the popover should be rendered inside a portal. Defaults to\n   * `true`.\n   *\n   * @see Docs https://reach.tech/menu-button#menulist-portal\n   */\n  portal?: boolean;\n  /**\n   * Can contain only `MenuItem` or a `MenuLink`.\n   *\n   * @see Docs https://reach.tech/menu-button#menulist-children\n   */\n  children: React.ReactNode;\n};\n\nif (__DEV__) {\n  MenuList.displayName = \"MenuList\";\n  MenuList.propTypes = {\n    children: PropTypes.node.isRequired,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * MenuPopover\n *\n * A low-level wrapper for the popover that appears when a menu button is open.\n * You can compose it with `MenuItems` for more control over the nested\n * components and their rendered DOM nodes, or if you need to nest arbitrary\n * components between the outer wrapper and your list.\n *\n * @see Docs https://reach.tech/menu-button#menupopover\n */\nconst MenuPopover = forwardRefWithAs<MenuPopoverProps, \"div\">(\n  function MenuPopover(\n    { as: Comp = \"div\", children, portal = true, position, ...props },\n    forwardedRef\n  ) {\n    const {\n      buttonRef,\n      buttonClickedRef,\n      dispatch,\n      menuRef,\n      popoverRef,\n      state: { isExpanded },\n    } = React.useContext(MenuContext);\n\n    const ref = useForkedRef(popoverRef, forwardedRef);\n\n    React.useEffect(() => {\n      let ownerDocument = getOwnerDocument(popoverRef.current)!;\n      function listener(event: MouseEvent | TouchEvent) {\n        if (buttonClickedRef.current) {\n          buttonClickedRef.current = false;\n        } else if (\n          !popoverContainsEventTarget(popoverRef.current, event.target)\n        ) {\n          // We on want to close only if focus rests outside the menu\n          dispatch({ type: CLOSE_MENU, payload: { buttonRef } });\n        }\n      }\n      ownerDocument.addEventListener(\"mousedown\", listener);\n      // see https://github.com/reach/reach-ui/pull/700#discussion_r530369265\n      // ownerDocument.addEventListener(\"touchstart\", listener);\n      return () => {\n        ownerDocument.removeEventListener(\"mousedown\", listener);\n        // ownerDocument.removeEventListener(\"touchstart\", listener);\n      };\n    }, [buttonClickedRef, buttonRef, dispatch, menuRef, popoverRef]);\n\n    let commonProps = {\n      ref,\n      // TODO: remove in 1.0\n      \"data-reach-menu\": \"\",\n      \"data-reach-menu-popover\": \"\",\n      hidden: !isExpanded,\n      children,\n      ...props,\n    };\n\n    return portal ? (\n      <Popover\n        {...commonProps}\n        as={Comp}\n        targetRef={buttonRef as any}\n        position={position}\n      />\n    ) : (\n      <Comp {...commonProps} />\n    );\n  }\n);\n\n/**\n * @see Docs https://reach.tech/menu-button#menupopover-props\n */\ntype MenuPopoverProps = {\n  /**\n   * Must contain a `MenuItems`\n   *\n   * @see Docs https://reach.tech/menu-button#menupopover-children\n   */\n  children: React.ReactNode;\n  /**\n   * Whether or not the popover should be rendered inside a portal. Defaults to\n   * `true`.\n   *\n   * @see Docs https://reach.tech/menu-button#menupopover-portal\n   */\n  portal?: boolean;\n  /**\n   * A function used to determine the position of the popover in relation to the\n   * menu button. By default, the menu button will attempt to position the\n   * popover below the button aligned with its left edge. If this positioning\n   * results in collisions with any side of the window, the popover will be\n   * anchored to a different side to avoid those collisions if possible.\n   *\n   * @see Docs https://reach.tech/menu-button#menupopover-position\n   */\n  position?: Position;\n};\n\nif (__DEV__) {\n  MenuPopover.displayName = \"MenuPopover\";\n  MenuPopover.propTypes = {\n    children: PropTypes.node,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * A hook that exposes data for a given `Menu` component to its descendants.\n *\n * @see Docs https://reach.tech/menu-button#usemenubuttoncontext\n */\nfunction useMenuButtonContext(): MenuContextValue {\n  let {\n    state: { isExpanded },\n  } = React.useContext(MenuContext);\n  return React.useMemo(() => ({ isExpanded }), [isExpanded]);\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * When a user's typed input matches the string displayed in a menu item, it is\n * expected that the matching menu item is selected. This is our matching\n * function.\n */\nfunction findItemFromTypeahead(\n  items: MenuButtonDescendant[],\n  string: string = \"\"\n) {\n  if (!string) {\n    return null;\n  }\n\n  const found = items.find((item) => {\n    return item.disabled\n      ? false\n      : item.element?.dataset?.valuetext?.toLowerCase().startsWith(string);\n  });\n  return found ? items.indexOf(found) : null;\n}\n\nfunction useMenuItemId(index: number | null) {\n  let { menuId } = React.useContext(MenuContext);\n  return index != null && index > -1\n    ? makeId(`option-${index}`, menuId)\n    : undefined;\n}\n\ninterface MenuButtonState {\n  isExpanded: boolean;\n  selectionIndex: number;\n  buttonId: null | string;\n  typeaheadQuery: string;\n}\n\ntype MenuButtonAction =\n  | { type: \"CLICK_MENU_ITEM\" }\n  | { type: \"CLOSE_MENU\"; payload: { buttonRef: ButtonRef } }\n  | { type: \"OPEN_MENU_AT_FIRST_ITEM\" }\n  | { type: \"OPEN_MENU_AT_INDEX\"; payload: { index: number } }\n  | { type: \"OPEN_MENU_CLEARED\" }\n  | {\n      type: \"SELECT_ITEM_AT_INDEX\";\n      payload: { max?: number; min?: number; index: number };\n    }\n  | { type: \"CLEAR_SELECTION_INDEX\" }\n  | { type: \"SET_BUTTON_ID\"; payload: string }\n  | { type: \"SEARCH_FOR_ITEM\"; payload: string };\n\nfunction isRightClick(nativeEvent: MouseEvent) {\n  return nativeEvent.which === 3 || nativeEvent.button === 2;\n}\n\nfunction focus<T extends HTMLElement = HTMLElement>(\n  element: T | undefined | null\n) {\n  element && element.focus();\n}\n\nfunction popoverContainsEventTarget(\n  popover: HTMLElement | null,\n  target: HTMLElement | EventTarget | null\n) {\n  return !!(popover && popover.contains(target as HTMLElement));\n}\n\nfunction reducer(\n  state: MenuButtonState,\n  action: MenuButtonAction = {} as MenuButtonAction\n): MenuButtonState {\n  switch (action.type) {\n    case CLICK_MENU_ITEM:\n      return {\n        ...state,\n        isExpanded: false,\n        selectionIndex: -1,\n      };\n    case CLOSE_MENU:\n      return {\n        ...state,\n        isExpanded: false,\n        selectionIndex: -1,\n      };\n    case OPEN_MENU_AT_FIRST_ITEM:\n      return {\n        ...state,\n        isExpanded: true,\n        selectionIndex: 0,\n      };\n    case OPEN_MENU_AT_INDEX:\n      return {\n        ...state,\n        isExpanded: true,\n        selectionIndex: action.payload.index,\n      };\n    case OPEN_MENU_CLEARED:\n      return {\n        ...state,\n        isExpanded: true,\n        selectionIndex: -1,\n      };\n    case SELECT_ITEM_AT_INDEX:\n      if (action.payload.index >= 0) {\n        return {\n          ...state,\n          selectionIndex:\n            action.payload.max != null\n              ? Math.min(Math.max(action.payload.index, 0), action.payload.max)\n              : Math.max(action.payload.index, 0),\n        };\n      }\n      return state;\n    case CLEAR_SELECTION_INDEX:\n      return {\n        ...state,\n        selectionIndex: -1,\n      };\n    case SET_BUTTON_ID:\n      return {\n        ...state,\n        buttonId: action.payload,\n      };\n    case SEARCH_FOR_ITEM:\n      if (typeof action.payload !== \"undefined\") {\n        return {\n          ...state,\n          typeaheadQuery: action.payload,\n        };\n      }\n      return state;\n    default:\n      return state;\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Types\n\ntype MenuButtonDescendant = Descendant<HTMLElement> & {\n  key: string;\n  isLink: boolean;\n  disabled?: boolean;\n};\n\ntype ButtonRef = React.RefObject<null | HTMLElement>;\ntype MenuRef = React.RefObject<null | HTMLElement>;\ntype PopoverRef = React.RefObject<null | HTMLElement>;\n\ninterface InternalMenuContextValue {\n  buttonRef: ButtonRef;\n  buttonClickedRef: React.MutableRefObject<boolean>;\n  dispatch: React.Dispatch<MenuButtonAction>;\n  menuId: string | undefined;\n  menuRef: MenuRef;\n  popoverRef: PopoverRef;\n  readyToSelect: React.MutableRefObject<boolean>;\n  selectCallbacks: React.MutableRefObject<(() => void)[]>;\n  state: MenuButtonState;\n}\n\ntype MenuContextValue = {\n  isExpanded: boolean;\n  // id: string | undefined;\n};\n\n////////////////////////////////////////////////////////////////////////////////\n// Exports\n\nexport type {\n  MenuButtonProps,\n  MenuContextValue,\n  MenuItemProps,\n  MenuItemsProps,\n  MenuLinkProps,\n  MenuListProps,\n  MenuPopoverProps,\n  MenuProps,\n};\nexport {\n  Menu,\n  MenuButton,\n  MenuItem,\n  MenuItems,\n  MenuLink,\n  MenuList,\n  MenuPopover,\n  useMenuButtonContext,\n};\n"],"names":["CLEAR_SELECTION_INDEX","CLICK_MENU_ITEM","CLOSE_MENU","OPEN_MENU_AT_FIRST_ITEM","OPEN_MENU_AT_INDEX","OPEN_MENU_CLEARED","SEARCH_FOR_ITEM","SELECT_ITEM_AT_INDEX","SET_BUTTON_ID","MenuDescendantContext","createDescendantContext","MenuContext","createNamedContext","initialState","buttonId","isExpanded","typeaheadQuery","selectionIndex","Menu","id","children","buttonRef","React","menuRef","popoverRef","useDescendantsInit","descendants","setDescendants","reducer","state","dispatch","_id","useId","menuId","makeId","buttonClickedRef","selectCallbacks","readyToSelect","context","window","__REACH_DISABLE_TOOLTIPS","requestAnimationFrame","focus","current","useCheckStyles","DescendantProvider","items","set","Provider","value","isFunction","isOpen","displayName","propTypes","PropTypes","oneOfType","func","node","MenuButton","forwardRefWithAs","forwardedRef","as","Comp","onKeyDown","onMouseDown","props","ref","useForkedRef","useDescendants","firstNonDisabledIndex","findIndex","item","disabled","newButtonId","type","payload","handleKeyDown","event","key","preventDefault","index","handleMouseDown","isRightClick","nativeEvent","undefined","wrapEvent","MenuItemImpl","indexProp","isLink","onClick","onDragStart","onMouseEnter","onMouseLeave","onMouseMove","onMouseUp","onSelect","valueTextProp","valueText","ownRef","setValueText","setValueTextFromDom","textContent","mouseEventStarted","useDescendant","element","isSelected","select","handleClick","handleDragStart","handleMouseEnter","handleMouseLeave","handleMouseMove","handleMouseUp","click","ownerDocument","getOwnerDocument","listener","addEventListener","removeEventListener","role","useMenuItemId","tabIndex","MenuItem","any","isRequired","MenuItems","menuItems","match","findItemFromTypeahead","timeout","setTimeout","clearTimeout","prevMenuItemsLength","usePrevious","length","prevSelected","prevSelectionIndex","i","selected","find","isString","query","toLowerCase","useDescendantKeyDown","currentIndex","orientation","rotate","filter","callback","MenuLink","component","console","warn","noop","MenuList","portal","MenuPopover","position","popoverContainsEventTarget","target","commonProps","hidden","Popover","targetRef","useMenuButtonContext","string","found","dataset","valuetext","startsWith","indexOf","which","button","popover","contains","action","max","Math","min"],"mappings":"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"}