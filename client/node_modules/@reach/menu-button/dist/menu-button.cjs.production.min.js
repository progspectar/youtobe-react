"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");require("prop-types");var n=require("@reach/auto-id"),t=require("@reach/popover"),r=require("@reach/descendants"),a=require("@reach/utils");function o(){return(o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function u(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n.indexOf(t=o[r])>=0||(a[t]=e[t]);return a}var i=r.createDescendantContext("MenuDescendantContext"),s=a.createNamedContext("MenuContext",{}),d={buttonId:null,isExpanded:!1,typeaheadQuery:"",selectionIndex:-1},c=a.forwardRefWithAs((function(n,t){var o=n.as,d=void 0===o?"button":o,c=n.onKeyDown,l=n.onMouseDown,E=n.id,f=u(n,["as","onKeyDown","onMouseDown","id"]),p=e.useContext(s),v=p.buttonRef,x=p.buttonClickedRef,y=p.menuId,m=p.state,I=m.buttonId,M=m.isExpanded,b=p.dispatch,w=a.useForkedRef(v,t),h=r.useDescendants(i),C=e.useMemo((function(){return h.findIndex((function(e){return!e.disabled}))}),[h]);return e.useEffect((function(){var e=null!=E?E:y?a.makeId("menu-button",y):"menu-button";I!==e&&b({type:"SET_BUTTON_ID",payload:e})}),[I,b,E,y]),e.createElement(d,Object.assign({"aria-expanded":!!M||void 0,"aria-haspopup":!0,"aria-controls":y},f,{ref:w,"data-reach-menu-button":"",id:I||void 0,onKeyDown:a.wrapEvent(c,(function(e){switch(e.key){case"ArrowDown":case"ArrowUp":e.preventDefault(),b({type:"OPEN_MENU_AT_INDEX",payload:{index:C}});break;case"Enter":case" ":b({type:"OPEN_MENU_AT_INDEX",payload:{index:C}})}})),onMouseDown:a.wrapEvent(l,(function(e){M||(x.current=!0),_(e.nativeEvent)||b(M?{type:"CLOSE_MENU",payload:{buttonRef:v}}:{type:"OPEN_MENU_CLEARED"})})),type:"button"}))})),l=a.forwardRefWithAs((function(n,t){var o=n.as,d=n.index,c=n.isLink,l=void 0!==c&&c,E=n.onClick,f=n.onDragStart,p=n.onMouseDown,v=n.onMouseEnter,x=n.onMouseLeave,I=n.onMouseMove,M=n.onMouseUp,b=n.onSelect,w=n.disabled,h=n.valueText,C=u(n,["as","index","isLink","onClick","onDragStart","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseUp","onSelect","disabled","valueText"]),T=e.useContext(s),D=T.buttonRef,R=T.dispatch,L=T.readyToSelect,k=T.selectCallbacks,O=T.state,N=O.selectionIndex,S=O.isExpanded,A=e.useRef(null),g=e.useState(h||""),U=g[0],P=g[1],j=e.useCallback((function(e){e&&(A.current=e,(!h||e.textContent&&U!==e.textContent)&&P(e.textContent))}),[U,h]),X=a.useForkedRef(t,j),F=e.useRef(!1),K=r.useDescendant({element:A.current,key:U,disabled:w,isLink:l},i,d),W=K===N&&!w;function q(){m(D.current),b&&b(),R({type:"CLICK_MENU_ITEM"})}return k.current[K]=b,e.useEffect((function(){S||(L.current=!1)}),[S,L]),e.useEffect((function(){var e=a.getOwnerDocument(A.current),n=function(){return F.current=!1};return e.addEventListener("mouseup",n),function(){return e.removeEventListener("mouseup",n)}}),[]),e.createElement(o,Object.assign({role:"menuitem",id:y(K),tabIndex:-1},C,{ref:X,"aria-disabled":w||void 0,"data-reach-menu-item":"","data-selected":W?"":void 0,"data-valuetext":U,onClick:a.wrapEvent(E,(function(e){l&&!_(e.nativeEvent)&&(w?e.preventDefault():q())})),onDragStart:a.wrapEvent(f,(function(e){l&&e.preventDefault()})),onMouseDown:a.wrapEvent(p,(function(e){_(e.nativeEvent)||(l?F.current=!0:e.preventDefault())})),onMouseEnter:a.wrapEvent(v,(function(e){W||null==K||w||R({type:"SELECT_ITEM_AT_INDEX",payload:{index:K}})})),onMouseLeave:a.wrapEvent(x,(function(e){R({type:"CLEAR_SELECTION_INDEX"})})),onMouseMove:a.wrapEvent(I,(function(){L.current=!0,W||null==K||w||R({type:"SELECT_ITEM_AT_INDEX",payload:{index:K}})})),onMouseUp:a.wrapEvent(M,(function(e){L.current?_(e.nativeEvent)||(l?F.current?F.current=!1:A.current&&A.current.click():w||q()):L.current=!0}))}))})),E=a.forwardRefWithAs((function(n,t){var r=n.as,a=void 0===r?"div":r,o=u(n,["as"]);return e.createElement(l,Object.assign({},o,{ref:t,as:a}))})),f=a.forwardRefWithAs((function(n,t){var o=n.as,d=void 0===o?"div":o,c=n.children,l=n.onKeyDown,E=u(n,["as","children","id","onKeyDown"]),f=e.useContext(s),p=f.menuId,v=f.dispatch,x=f.buttonRef,_=f.menuRef,I=f.selectCallbacks,M=f.state,b=M.isExpanded,w=M.buttonId,h=M.selectionIndex,C=M.typeaheadQuery,T=r.useDescendants(i),D=a.useForkedRef(_,t);e.useEffect((function(){var e=function(e,n){if(void 0===n&&(n=""),!n)return null;var t=e.find((function(e){var t,r,a;return!e.disabled&&(null===(t=e.element)||void 0===t||null===(r=t.dataset)||void 0===r||null===(a=r.valuetext)||void 0===a?void 0:a.toLowerCase().startsWith(n))}));return t?e.indexOf(t):null}(T,C);C&&null!=e&&v({type:"SELECT_ITEM_AT_INDEX",payload:{index:e}});var n=window.setTimeout((function(){return C&&v({type:"SEARCH_FOR_ITEM",payload:""})}),1e3);return function(){return window.clearTimeout(n)}}),[v,T,C]);var R=a.usePrevious(T.length),L=a.usePrevious(T[h]),k=a.usePrevious(h);e.useEffect((function(){h>T.length-1?v({type:"SELECT_ITEM_AT_INDEX",payload:{index:T.length-1}}):R!==T.length&&h>-1&&L&&k===h&&T[h]!==L&&v({type:"SELECT_ITEM_AT_INDEX",payload:{index:T.findIndex((function(e){return e.key===L.key}))}})}),[v,T,R,L,k,h]);var O=a.wrapEvent((function(e){var n=e.key;if(b)switch(n){case"Enter":case" ":var t=T.find((function(e){return e.index===h}));t&&(t.isLink&&t.element?t.element.click():(e.preventDefault(),m(x.current),I.current[t.index]&&I.current[t.index](),v({type:"CLICK_MENU_ITEM"})));break;case"Escape":m(x.current),v({type:"CLOSE_MENU",payload:{buttonRef:x}});break;case"Tab":e.preventDefault();break;default:if(a.isString(n)&&1===n.length){var r=C+n.toLowerCase();v({type:"SEARCH_FOR_ITEM",payload:r})}}}),r.useDescendantKeyDown(i,{currentIndex:h,orientation:"vertical",rotate:!1,filter:function(e){return!e.disabled},callback:function(e){v({type:"SELECT_ITEM_AT_INDEX",payload:{index:e}})},key:"index"}));return e.createElement(d,Object.assign({"aria-activedescendant":y(h)||void 0,"aria-labelledby":w||void 0,role:"menu",tabIndex:-1},E,{ref:D,"data-reach-menu-items":"",id:p,onKeyDown:a.wrapEvent(l,O)}),c)})),p=a.forwardRefWithAs((function(n,t){var r=n.as,o=void 0===r?"a":r,i=n.component,s=n.onSelect,d=u(n,["as","component","onSelect"]);return i&&console.warn("[@reach/menu-button]: Please use the `as` prop instead of `component`."),e.createElement("div",{role:"none",tabIndex:-1},e.createElement(l,Object.assign({},d,{ref:t,"data-reach-menu-link":"",as:o,isLink:!0,onSelect:s||a.noop})))})),v=a.forwardRefWithAs((function(n,t){var r=n.portal,a=void 0===r||r,o=u(n,["portal"]);return e.createElement(x,{portal:a},e.createElement(f,Object.assign({},o,{ref:t,"data-reach-menu-list":""})))})),x=a.forwardRefWithAs((function(n,r){var i=n.as,d=void 0===i?"div":i,c=n.children,l=n.portal,E=void 0===l||l,f=n.position,p=u(n,["as","children","portal","position"]),v=e.useContext(s),x=v.buttonRef,y=v.buttonClickedRef,_=v.dispatch,m=v.menuRef,I=v.popoverRef,M=v.state.isExpanded,b=a.useForkedRef(I,r);e.useEffect((function(){var e=a.getOwnerDocument(I.current);function n(e){y.current?y.current=!1:function(e,n){return!(!e||!e.contains(n))}(I.current,e.target)||_({type:"CLOSE_MENU",payload:{buttonRef:x}})}return e.addEventListener("mousedown",n),function(){e.removeEventListener("mousedown",n)}}),[y,x,_,m,I]);var w=o({ref:b,"data-reach-menu":"","data-reach-menu-popover":"",hidden:!M,children:c},p);return E?e.createElement(t.Popover,Object.assign({},w,{as:d,targetRef:x,position:f})):e.createElement(d,Object.assign({},w))}));function y(n){var t=e.useContext(s);return null!=n&&n>-1?a.makeId("option-"+n,t.menuId):void 0}function _(e){return 3===e.which||2===e.button}function m(e){e&&e.focus()}function I(e,n){switch(void 0===n&&(n={}),n.type){case"CLICK_MENU_ITEM":case"CLOSE_MENU":return o({},e,{isExpanded:!1,selectionIndex:-1});case"OPEN_MENU_AT_FIRST_ITEM":return o({},e,{isExpanded:!0,selectionIndex:0});case"OPEN_MENU_AT_INDEX":return o({},e,{isExpanded:!0,selectionIndex:n.payload.index});case"OPEN_MENU_CLEARED":return o({},e,{isExpanded:!0,selectionIndex:-1});case"SELECT_ITEM_AT_INDEX":return n.payload.index>=0?o({},e,{selectionIndex:null!=n.payload.max?Math.min(Math.max(n.payload.index,0),n.payload.max):Math.max(n.payload.index,0)}):e;case"CLEAR_SELECTION_INDEX":return o({},e,{selectionIndex:-1});case"SET_BUTTON_ID":return o({},e,{buttonId:n.payload});case"SEARCH_FOR_ITEM":return void 0!==n.payload?o({},e,{typeaheadQuery:n.payload}):e;default:return e}}exports.Menu=function(t){var o=t.id,u=t.children,c=e.useRef(null),l=e.useRef(null),E=e.useRef(null),f=r.useDescendantsInit(),p=f[0],v=f[1],x=e.useReducer(I,d),y=x[0],_=x[1],M=n.useId(o),b=o||a.makeId("menu",M),w=e.useRef(!1),h=e.useRef([]),C=e.useRef(!1),T={buttonRef:c,dispatch:_,menuId:b,menuRef:l,popoverRef:E,buttonClickedRef:w,readyToSelect:C,selectCallbacks:h,state:y};return e.useEffect((function(){y.isExpanded?(window.__REACH_DISABLE_TOOLTIPS=!0,window.requestAnimationFrame((function(){m(l.current)}))):window.__REACH_DISABLE_TOOLTIPS=!1}),[y.isExpanded]),a.useCheckStyles("menu-button"),e.createElement(r.DescendantProvider,{context:i,items:p,set:v},e.createElement(s.Provider,{value:T},a.isFunction(u)?u({isExpanded:y.isExpanded,isOpen:y.isExpanded}):u))},exports.MenuButton=c,exports.MenuItem=E,exports.MenuItems=f,exports.MenuLink=p,exports.MenuList=v,exports.MenuPopover=x,exports.useMenuButtonContext=function(){var n=e.useContext(s).state.isExpanded;return e.useMemo((function(){return{isExpanded:n}}),[n])};
//# sourceMappingURL=menu-button.cjs.production.min.js.map
